const stops4 = {
  "bustime-response": {
    "stops": [
      {
        "stpid": "12",
        "stpnm": "ALLEN AVE + 97 ALLEN AVE",
        "lat": 43.691920000001,
        "lon": -70.292724000001
      },
      {
        "stpid": "13",
        "stpnm": "ALLEN AVE + ABBOTT ST",
        "lat": 43.698284999999,
        "lon": -70.289216999999
      },
      {
        "stpid": "380",
        "stpnm": "ALLEN AVE + FOREST AVE",
        "lat": 43.689120999999,
        "lon": -70.293474999999
      },
      {
        "stpid": "27",
        "stpnm": "ALLEN AVE + PLYMOUTH ST",
        "lat": 43.693584999999,
        "lon": -70.29228
      },
      {
        "stpid": "18",
        "stpnm": "CBHS OUTBOUND",
        "lat": 43.694964999999,
        "lon": -70.291808999998
      },
      {
        "stpid": "158",
        "stpnm": "CONGRESS ST + 1189 CONGRESS ST",
        "lat": 43.656909000001,
        "lon": -70.288522
      },
      {
        "stpid": "651",
        "stpnm": "CONGRESS ST + 1329 CONGRESS ST",
        "lat": 43.658687999999,
        "lon": -70.294609999999
      },
      {
        "stpid": "121",
        "stpnm": "CONGRESS ST + 389 CONGRESS ST",
        "lat": 43.658929000001,
        "lon": -70.25722999999903
      },
      {
        "stpid": "118",
        "stpnm": "CONGRESS ST + CASCO ST",
        "lat": 43.656207999999,
        "lon": -70.260873
      },
      {
        "stpid": "122",
        "stpnm": "CONGRESS ST + DEERING AVE",
        "lat": 43.654090999999,
        "lon": -70.272529999999
      },
      {
        "stpid": "130",
        "stpnm": "CONGRESS ST + ELM ST",
        "lat": 43.657578000001,
        "lon": -70.259053
      },
      {
        "stpid": "132",
        "stpnm": "CONGRESS ST + FOREST AVE",
        "lat": 43.654801,
        "lon": -70.262371999999
      },
      {
        "stpid": "160",
        "stpnm": "CONGRESS ST + MELLEN ST",
        "lat": 43.653153000001,
        "lon": -70.269663999999
      },
      {
        "stpid": "168",
        "stpnm": "CONGRESS ST + PARK ST",
        "lat": 43.653494000001,
        "lon": -70.264953999999
      },
      {
        "stpid": "175",
        "stpnm": "CONGRESS ST + STATE ST",
        "lat": 43.653125999999,
        "lon": -70.267623999998
      },
      {
        "stpid": "172",
        "stpnm": "CONGRESS ST + VALLEY ST",
        "lat": 43.653827,
        "lon": -70.278553999999
      },
      {
        "stpid": "183",
        "stpnm": "CONGRESS ST + WEYMOUTH ST",
        "lat": 43.654793,
        "lon": -70.275757999998
      },
      {
        "stpid": "185",
        "stpnm": "CONGRESS ST + WHITNEY ST",
        "lat": 43.657758999999,
        "lon": -70.291025999999
      },
      {
        "stpid": "415",
        "stpnm": "PARK AVE + MARSTON ST",
        "lat": 43.655890999999,
        "lon": -70.283774999999
      },
      {
        "stpid": "416",
        "stpnm": "PARK AVE + ST JOHN ST",
        "lat": 43.655870000001,
        "lon": -70.281027999999
      },
      {
        "stpid": "497",
        "stpnm": "ST JOHN ST + 325 ST JOHN ST",
        "lat": 43.654297000001,
        "lon": -70.279690999998
      },
      {
        "stpid": "511",
        "stpnm": "STEVENS AVE + 825 STEVENS AVE",
        "lat": 43.686722999999,
        "lon": -70.293299999998
      },
      {
        "stpid": "504",
        "stpnm": "STEVENS AVE + ANSON ST",
        "lat": 43.662410000001,
        "lon": -70.297841000001
      },
      {
        "stpid": "519",
        "stpnm": "STEVENS AVE + ARBOR ST",
        "lat": 43.685082000001,
        "lon": -70.293490000001
      },
      {
        "stpid": "502",
        "stpnm": "STEVENS AVE + BRIGHTON AVE",
        "lat": 43.666171,
        "lon": -70.295845
      },
      {
        "stpid": "516",
        "stpnm": "STEVENS AVE + CONGRESS ST",
        "lat": 43.659618999999,
        "lon": -70.296859000001
      },
      {
        "stpid": "509",
        "stpnm": "STEVENS AVE + ELMWOOD ST",
        "lat": 43.682558000001,
        "lon": -70.293826000002
      },
      {
        "stpid": "507",
        "stpnm": "STEVENS AVE + NEW ST",
        "lat": 43.677549999999,
        "lon": -70.294457000002
      },
      {
        "stpid": "518",
        "stpnm": "STEVENS AVE + ORKNEY ST",
        "lat": 43.671560999999,
        "lon": -70.294979999998
      },
      {
        "stpid": "512",
        "stpnm": "STEVENS AVE + PERCIVAL ST",
        "lat": 43.676158,
        "lon": -70.294611
      },
      {
        "stpid": "500",
        "stpnm": "STEVENS AVE + PLEASANT AVE",
        "lat": 43.674380999999,
        "lon": -70.295120999999
      },
      {
        "stpid": "521",
        "stpnm": "STEVENS AVE + PROSPECT ST",
        "lat": 43.667706000001,
        "lon": -70.295334999999
      },
      {
        "stpid": "523",
        "stpnm": "STEVENS AVE + RACKLEFF ST",
        "lat": 43.669025,
        "lon": -70.294896999999
      },
      {
        "stpid": "515",
        "stpnm": "STEVENS AVE + WALTON ST",
        "lat": 43.680428000001,
        "lon": -70.294096
      },
      {
        "stpid": "606",
        "stpnm": "WASHINGTON AVE + 1364 WASHINGTON AVE",
        "lat": 43.698896,
        "lon": -70.28749500000197
      },
      {
        "stpid": "617",
        "stpnm": "WASHINGTON AVE + 1476 WASHINGTON AVE",
        "lat": 43.702261999999,
        "lon": -70.290249000001
      },
      {
        "stpid": "628",
        "stpnm": "WASHINGTON AVE + 1751 WASHINGTON AVE",
        "lat": 43.709726,
        "lon": -70.297348
      },
      {
        "stpid": "560",
        "stpnm": "WASHINGTON AVE + AUBURN ST",
        "lat": 43.721239000001,
        "lon": -70.29380800000098
      },
      {
        "stpid": "594",
        "stpnm": "WASHINGTON AVE + GREENWOOD LN",
        "lat": 43.707714,
        "lon": -70.295372999999
      },
      {
        "stpid": "623",
        "stpnm": "WASHINGTON AVE + REGAN LN",
        "lat": 43.706133000001,
        "lon": -70.293187999999
      },
      {
        "stpid": "625",
        "stpnm": "WASHINGTON AVE + RIVERSIDE DR",
        "lat": 43.715399999999,
        "lon": -70.301295999998
      },
      {
        "stpid": "627",
        "stpnm": "WASHINGTON AVE + SANBORN ST",
        "lat": 43.703566,
        "lon": -70.291416999998
      },
      {
        "stpid": "633",
        "stpnm": "WASHINGTON AVE + STONECREST DR",
        "lat": 43.719026000001,
        "lon": -70.299814999999
      }
    ]
  }
}

function distance(lat1, lon1, lat2, lon2) {
  const p = 0.017453292519943295;
  const c = Math.cos;
  const a = 0.5 - c((lat2 - lat1) * p)/2 +
          c(lat1 * p) * c(lat2 * p) *
          (1 - c((lon2 - lon1) * p))/2;

  return 12742 * Math.asin(Math.sqrt(a));
}

var x = document.getElementById("demo");

function getLocation (route) {
  console.log(route)
  if (navigator.geolocation) {
    x.innerHTML = "Getting your position..."
    navigator.geolocation.getCurrentPosition(showPosition);
  } else {
    x.innerHTML = "Geolocation is not supported by this browser."
  }
}

function showPosition(position) {
  x.innerHTML = "Got your position..."
  kickShitOff(position.coords.latitude, position.coords.longitude)
}

function kickShitOff (lat, long) {
  console.log(lat + ' ' + long)

  const myLat = lat
  const myLong = long

  const stopz = stops4['bustime-response']['stops']

  const myObject = {}
  for (var i = 0; i < stopz.length; i++) {
    const myDistance = distance(myLat, myLong, stopz[i].lat, stopz[i].lon)
    myObject[myDistance] = i
  }

  const measurements = Object.keys(myObject)
  const smallest = myObject[Math.min(...measurements)]
  x.innerHTML = stopz[smallest].stpnm + ' with a stpid of ' + stopz[smallest].stpid
}
